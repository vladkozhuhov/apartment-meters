# Настройка CI/CD в проекте Apartment Meters

Это руководство поможет вам настроить CI/CD процесс в проекте Apartment Meters с использованием GitHub Actions.

## Предварительные требования

1. Ваш проект должен быть размещен на GitHub.
2. Вы должны иметь права администратора в репозитории.
3. Базовые знания Git и GitHub.

## Установка и настройка

### Шаг 1: Добавление workflow файлов

В вашем репозитории уже созданы все необходимые workflow файлы в директории `.github/workflows`:
- `ci.yml` - Continuous Integration workflow
- `cd.yml` - Continuous Deployment workflow
- `release.yml` - Release workflow
- `version-bump.yml` - Version Bump workflow

### Шаг 2: Настройка прав доступа для GitHub Actions

Для корректной работы CI/CD, особенно для процесса создания релизов и обновления версий, необходимо правильно настроить права доступа:

1. Перейдите в настройки репозитория (Settings)
2. Выберите раздел "Actions" -> "General"
3. В разделе "Workflow permissions" выберите "Read and write permissions"
4. Сохраните изменения

### Шаг 3: Настройка секретов (если требуется)

Если вы настраиваете реальный деплой (например, на сервер или в облако), вам потребуется добавить соответствующие секреты:

1. Перейдите в настройки репозитория (Settings)
2. Выберите раздел "Secrets and variables" -> "Actions"
3. Нажмите "New repository secret"
4. Добавьте необходимые секреты (например, SSH-ключи, токены API и т.д.)

### Шаг 4: Настройка защиты веток (рекомендуется)

Для обеспечения качества кода рекомендуется настроить защиту основных веток:

1. Перейдите в настройки репозитория (Settings)
2. Выберите раздел "Branches"
3. Нажмите "Add rule"
4. Укажите шаблон ветки (например, `main` или `develop`)
5. Выберите опции:
   - "Require a pull request before merging"
   - "Require status checks to pass before merging"
   - В поле "Status checks that are required" добавьте "build" (это название job в CI workflow)

## Использование CI/CD

### Непрерывная интеграция (CI)

CI процесс запускается автоматически при каждом пуше в основные ветки или при создании Pull Request. Вы можете следить за результатами во вкладке "Actions" в вашем репозитории.

### Создание новой версии

Для создания новой версии:

1. Перейдите во вкладку "Actions" в вашем репозитории
2. Выберите workflow "Version Bump" в левом меню
3. Нажмите кнопку "Run workflow"
4. Выберите тип обновления версии (major, minor, patch)
5. Нажмите "Run workflow"

Это автоматически обновит версию в файлах проекта, создаст новый тег и запустит процесс создания релиза.

### Деплой приложения

Если настроен CD процесс, деплой выполняется автоматически после успешного выполнения CI процесса в ветках `main` или `master`.

## Отладка и решение проблем

### Логи выполнения workflow

Для просмотра логов выполнения workflow:

1. Перейдите во вкладку "Actions" в репозитории
2. Выберите интересующий вас workflow и конкретный запуск
3. Проверьте результаты каждого шага

### Частые проблемы

1. **Проблема**: Workflow не запускается
   **Решение**: Проверьте, что файлы workflow находятся в правильной директории (`.github/workflows`) и имеют корректный YAML-синтаксис.

2. **Проблема**: Ошибка "Resource not accessible by integration" в workflow version-bump или release
   **Решение**: Проверьте настройки "Workflow permissions" в настройках репозитория.

3. **Проблема**: Тесты не проходят в CI
   **Решение**: Запустите тесты локально с теми же параметрами, которые используются в CI workflow, чтобы выявить и исправить проблему.

## Расширение и кастомизация

Вы можете кастомизировать CI/CD процесс под свои нужды:

1. Для деплоя в реальные среды отредактируйте `.github/workflows/cd.yml`, добавив необходимые шаги (например, копирование файлов на сервер через SCP/SFTP, деплой в Docker/Kubernetes и т.д.)

2. Для добавления дополнительных проверок кода отредактируйте `.github/workflows/ci.yml` и добавьте соответствующие шаги.

3. Если вы используете Docker, добавьте шаги для сборки и публикации Docker-образов в `.github/workflows/ci.yml` или `.github/workflows/release.yml`.

## Дополнительные ресурсы

- [Документация GitHub Actions](https://docs.github.com/en/actions)
- [Синтаксис workflow файлов](https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions)
- [Marketplace GitHub Actions](https://github.com/marketplace?type=actions) - готовые actions для различных задач 