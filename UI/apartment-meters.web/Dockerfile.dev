FROM node:18-alpine

WORKDIR /app

# Копируем package.json и package-lock.json
COPY package*.json ./

# Устанавливаем зависимости
RUN npm ci

# Копируем исходный код
COPY . .

# Создаем файл переменных окружения во время запуска контейнера
RUN echo "#!/bin/sh\n" \
    "echo \"NEXT_PUBLIC_API_URL=\$NEXT_PUBLIC_API_URL\" > .env.local\n" \
    "echo \"Setting NEXT_PUBLIC_API_URL to \$NEXT_PUBLIC_API_URL\"\n" \
    "npm run dev" > /app/start.sh && \
    chmod +x /app/start.sh

# Указываем порт
EXPOSE 3000

# Запускаем в режиме разработки
ENV NODE_ENV=development
CMD ["/app/start.sh"] 